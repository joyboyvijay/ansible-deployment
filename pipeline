pipeline {
    agent any

    // Remove the invalid tools block
    // tools { ansible 'ansible' }  // ‚ùå

    environment {
        ANSIBLE_HOST_KEY_CHECKING = 'False'
    }

    stages {
        stage('Checkout Ansible Repo') {
            steps {
                deleteDir()
                git branch: 'main',
                    credentialsId: 'vijaypassid',
                    url: 'https://github.com/joyboyvijay/ansible-deployment.git'
            }
        }

        stage('Checkout Website Repo') {
            steps {
                dir('web-src') {
                    git branch: 'main',
                        credentialsId: 'vijaypassid',
                        url: 'https://github.com/joyboyvijay/webfiles.git'
                }
            }
        }

        stage('Deploy with Ansible') {
            steps {
                // Use the Ansible plugin's credentials handling
                ansiblePlaybook(
                    playbook: 'deploy.yml',
                    inventory: 'hosts.ini',                // <-- Use the correct path. If it's 'inventory/hosts.ini', change it accordingly.
                    colorized: true,
                    credentialsId: 'vijaysshid',           // <-- Jenkins SSH key for remote hosts
                    extraVars: [
                        web_src: "${WORKSPACE}/web-src"     // <-- Pass absolute path so copy can find the file
                    ]
                    // You no longer need 'extras' or --private-key
                )
            }
        }
    }
}
